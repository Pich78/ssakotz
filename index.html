<!doctype html>
<head>
    <meta charset="utf-8">
    <title>Saint Seiya Awakening - Knight of the Zodiac Calculator</title>
    <!-- <script data-main="app" src="lib/require.js"></script> -->
</head>
<body>
    <h1>Saint Seiya Awakening - Knights of the Zodiac Calculator</h1>
    <select id="saints-choice-dropdown" name="saints" onchange="saintSelected(this)">
    </select>
    <p id="saint"></p>
    <p id="saints"></p>
    <img src="" id="saintImage" />
    <script>
    let dropdown = document.getElementById('saints-choice-dropdown');
    dropdown.length = 0;

    let defaultOption = document.createElement('option');
    defaultOption.text = 'Choose Saint';

    dropdown.add(defaultOption);
    dropdown.selectedIndex = 0;

    const url = 'https://api.github.com/repos/Pich78/ssakotz/contents/saints?ref=gh-pages';

    fetch(url)  
    .then(  
        function(response) {

            if (response.status !== 200) {  
                console.warn('Looks like there was a problem. Status Code: ' + 
                response.status);  
                return;  
            }

            // Examine the text in the response  
            response.json()
            .then(
                
                function(data) {

                    let option;
        
                    for (let i = 0; i < data.length; i++) {

                        option = document.createElement('option');
                        option.text = data[i].name;
                        option.innerHTML = data[i].name;
                        //option.value = data[i].abbreviation;
                        option.value = i;
                        dropdown.add(option);
                        //console.log(option);
                        /*
                        fetch('saints/' + data[i].name + '/' + data[0].name + '.jpg')
                        .then(response => response.blob())
                        .then(function(myBlob) {
                            var objectURL = URL.createObjectURL(myBlob);
                            document.getElementById('saintImage').src = objectURL;         
                        });
                        */
                    }
                } 
            )
        })
    .catch(function(err) {  
        console.error('Fetch Error -', err);  
    });

    function saintSelected(choice) {
        console.log(choice);
        console.log(choice.value);
        var choiceName = choice.options[choice.selectedIndex].text;
        console.log(choiceName);
        fetch('saints/' + choiceName + '/' + choiceName + '.jpg')
        .then(response => response.blob())
        .then(function(myBlob) {
            var objectURL = URL.createObjectURL(myBlob);
            document.getElementById('saintImage').src = objectURL;         
        });
 

    }

</script>
</body>   
</html>
